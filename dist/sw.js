const CACHE_NAME="ceritakita-manual-cache-v1",urlsToCache=["/","/index.html","/manifest.json","/styles/main.css","/assets/images/icon-192x192.png","/assets/images/icon-512x512.png","/assets/favicon.ico"];self.addEventListener("install",(e=>{console.log("Service Worker (Manual): Installing..."),e.waitUntil(caches.open(CACHE_NAME).then((e=>(console.log("Service Worker (Manual): Caching app shell"),e.addAll(urlsToCache.map((e=>new Request(e,{cache:"reload"})))).catch((e=>{console.error("Service Worker (Manual): Gagal precache salah satu URL:",e)}))))).then((()=>{console.log("Service Worker (Manual): Install complete."),self.skipWaiting()})).catch((e=>{console.error("Service Worker (Manual): Failed to cache app shell during install:",e)})))})),self.addEventListener("activate",(e=>{console.log("Service Worker (Manual): Activating..."),e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>{if(e!==CACHE_NAME)return console.log("Service Worker (Manual): Deleting old cache:",e),caches.delete(e)}))))).then((()=>(console.log("Service Worker (Manual): Activation complete."),self.clients.claim()))))})),self.addEventListener("fetch",(e=>{"GET"===e.request.method&&(e.request.url.startsWith(self.location.origin)||e.request.url.includes("tile.openstreetmap.org")||e.request.url.includes("server.arcgisonline.com")?e.respondWith(caches.match(e.request).then((t=>t||fetch(e.request).then((t=>{if(t&&200===t.status){const s=t.clone();caches.open(CACHE_NAME).then((t=>{t.put(e.request,s)}))}return t})).catch((t=>{console.error("SW Fetch Error:",e.request.url,t)}))))):e.request.url.startsWith("https://story-api.dicoding.dev")?e.respondWith(fetch(e.request).then((t=>{if(t&&200===t.status){const s=t.clone();caches.open(CACHE_NAME).then((t=>{t.put(e.request,s)}))}return t})).catch((()=>caches.match(e.request)))):e.respondWith(fetch(e.request)))})),self.addEventListener("push",(e=>{let t;console.log("Service Worker: Push Received.");try{t=e.data.json()}catch(s){t={title:"Notifikasi Baru",body:e.data.text()}}const s=t.title||"Aplikasi CeritaKita",a={body:t.body||"Anda memiliki pesan baru.",icon:t.icon||"assets/images/icon-192x192.png",badge:t.badge||"assets/images/badge-72x72.png",image:t.image,data:{url:t.url||"/"},actions:t.actions||[]};e.waitUntil(self.registration.showNotification(s,a))})),self.addEventListener("notificationclick",(e=>{console.log("Service Worker: Notification click Received."),e.notification.close();const t=e.notification.data.url||"/";e.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((e=>{for(const s of e)if(s.url===t&&"focus"in s)return s.focus();if(clients.openWindow)return clients.openWindow(t)})))}));